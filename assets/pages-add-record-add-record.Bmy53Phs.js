import{l as e,r as a,m as l,p as s,E as t,G as c,c as u,w as o,B as n,h as d,i as r,o as i,b as v,e as m,f,z as p,F as _,A as y,y as g,I as k,x,g as Y,s as h}from"./index-CpIGjQk-.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=b({__name:"add-record",setup(b,{expose:C}){const I=e();console.log(I.currentrecordId);const M=a(!1),D=a("expense"),V=a(""),w=a(""),F=a(""),U=a(l().format("YYYY-MM-DD")),j=s(()=>I.categories[D.value]),R=s(()=>V.value&&w.value&&parseFloat(w.value)>0),T=e=>{D.value=e,V.value=""},z=e=>{U.value=e.detail.value},A=async()=>{if(R.value)try{if(I.currentrecordId){const e={type:D.value,category:V.value,amount:parseFloat(w.value),remark:F.value,date:U.value};(await I.updateRecord(I.currentrecordId,e)).success?h({title:"修改记录成功",icon:"success"}):h({title:result.message||"修改失败",icon:"none"})}else{const e={type:D.value,category:V.value,amount:parseFloat(w.value),remark:F.value,date:U.value},a=await I.addRecord(e);a.success?h({title:"记录成功",icon:"success"}):h({title:a.message||"保存失败",icon:"none"})}B(),E()}catch(e){h({title:"网络错误，请重试",icon:"none"})}else h({title:"请填写完整信息",icon:"none"})},B=()=>{D.value="expense",V.value="",w.value="",F.value="",U.value=l().format("YYYY-MM-DD")},E=()=>{M.value=!1,setTimeout(()=>{B(),d({url:"/pages/detail/detail"})},300)},G=()=>{M.value=!0};return C({openModal:G}),t(()=>{setTimeout(()=>{if(G(),I.currentrecordId){let e=I.records.find(e=>e.id==I.currentrecordId);console.log(e,"item"),e&&(w.value=e.amount,F.value=e.remark,D.value=e.type,V.value=e.category,U.value=e.date)}},100)}),c(()=>{console.log("出去"),E()}),(e,a)=>{const s=r,t=m,c=k,d=x,h=Y;return i(),u(s,{class:n(["add-record-container",{show:M.value}])},{default:o(()=>[v(s,{class:"mask",onClick:E}),v(s,{class:n(["modal-content",{slideUp:M.value}])},{default:o(()=>[v(s,{class:"modal-header"},{default:o(()=>[v(t,{class:"header-title"},{default:o(()=>[f("记一笔")]),_:1}),v(t,{class:"close-btn",onClick:E},{default:o(()=>[f("×")]),_:1})]),_:1}),v(s,{class:"type-selector"},{default:o(()=>[v(s,{class:n(["type-item",{active:"expense"===D.value}]),onClick:a[0]||(a[0]=e=>T("expense"))},{default:o(()=>[v(t,{class:"type-text"},{default:o(()=>[f("支出")]),_:1})]),_:1},8,["class"]),v(s,{class:n(["type-item",{active:"income"===D.value}]),onClick:a[1]||(a[1]=e=>T("income"))},{default:o(()=>[v(t,{class:"type-text"},{default:o(()=>[f("收入")]),_:1})]),_:1},8,["class"])]),_:1}),v(s,{class:"category-section"},{default:o(()=>[v(t,{class:"section-title"},{default:o(()=>[f("选择类别")]),_:1}),v(s,{class:"category-grid"},{default:o(()=>[(i(!0),p(_,null,y(j.value,e=>(i(),u(s,{key:e.id,class:n(["category-item",{active:V.value===e.name}]),onClick:a=>{return l=e.name,void(V.value=l);var l}},{default:o(()=>[v(t,{class:"category-icon"},{default:o(()=>[f(g(e.icon),1)]),_:2},1024),v(t,{class:"category-name"},{default:o(()=>[f(g(e.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),v(s,{class:"amount-section"},{default:o(()=>[v(t,{class:"section-title"},{default:o(()=>[f("金额")]),_:1}),v(s,{class:"amount-input-container"},{default:o(()=>[v(t,{class:"currency-symbol"},{default:o(()=>[f("¥")]),_:1}),v(c,{class:"amount-input",modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=e=>w.value=e),type:"digit",placeholder:"0.00"},null,8,["modelValue"])]),_:1})]),_:1}),v(s,{class:"remark-section"},{default:o(()=>[v(t,{class:"section-title"},{default:o(()=>[f("备注")]),_:1}),v(c,{class:"remark-input",modelValue:F.value,"onUpdate:modelValue":a[3]||(a[3]=e=>F.value=e),placeholder:"添加备注（可选）",maxlength:"50"},null,8,["modelValue"])]),_:1}),v(s,{class:"date-section"},{default:o(()=>[v(t,{class:"section-title"},{default:o(()=>[f("日期")]),_:1}),v(d,{mode:"date",value:U.value,onChange:z},{default:o(()=>[v(s,{class:"date-display"},{default:o(()=>[v(t,{class:"date-text"},{default:o(()=>{return[f(g((e=U.value,l(e).format("YYYY年MM月DD日"))),1)];var e}),_:1}),v(t,{class:"date-icon"},{default:o(()=>[f("▼")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),v(s,{class:"action-buttons"},{default:o(()=>[v(h,{class:"cancel-btn",onClick:E},{default:o(()=>[f("取消")]),_:1}),v(h,{class:"confirm-btn",onClick:A,disabled:!R.value},{default:o(()=>[f("完成")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["class"])]),_:1},8,["class"])}}},[["__scopeId","data-v-0f2cb660"]]);export{C as default};
